name: Dependency-Check
##on:
##  schedule:
##    - cron:  '0 0 1 * *'

on:
  push:
    branches: [master, dev]
    paths-ignore:
      - '**.md'
  pull_request:

jobs:
  dependency-check:
    runs-on: ubuntu-latest
    name: dependency-check
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Set up JDK 1.8
        uses: actions/setup-java@v1
        with:
          java-version: 1.8
      - name: Build Maven with Docker Profile
        run: mvn clean install -Pdocker -DskipTests -B
      - name: Set up JDK 11
        uses: actions/setup-java@v1
        with:
          java-version: 11
      - name: Dependency-Check Run
        uses: dependency-check/Dependency-Check_Action@main
        id: dependency-check
        with:
          project: 'OWASP Security Shepherd'
          path: '.'
          format: 'HTML'
          args: >
            --format JSON
            --prettyPrint
            --failOnCVSS 7
      - name: Publish Dependency-Check Results
        uses: actions/upload-artifact@master
        with:
           name: Dependency-Check report
           path: ${{github.workspace}}/reports
